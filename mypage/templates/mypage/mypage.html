{% extends '../base.html' %}
{% load static %}
{% block style %}
{% load sass_tags %}
    <link rel="stylesheet" type="text/css" href="{% sass_src 'mypage/scss/mypage.scss' %}"/>
{% endblock style %}

{% block content %}
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=84f8fca347220d053f38cd40691e54c1&libraries=services,drawing"></script>

<div class="mypage-layout">
    <div class="mypage_wrap">
        <div class="profile_wrap">
            <div class="profile">
                <h1 class="workbook">{{user.profile.username}}ì˜ ì›Œí¬ë¶</h1>
                <div class="profile-box">
                    <div id="walkroad-count">
                        ì´ {{registeredWalkroads.count}} ê°œì˜ ì‚°ì±…ë¡œë¥¼ ë“±ë¡í–ˆë„¤ìš”!
                    </div>
                    <div id="profile1">
                        {% if user.profile.feature == ''%}
                            ì•„ì§ ì„ í˜¸í•˜ëŠ” ì‚°ì±…ë¡œ íŠ¹ì§•ì„ ë“±ë¡í•˜ì§€ ì•Šìœ¼ì…¨ë„¤ìš”! 
                        {% else %}
                        ì„ í˜¸í•˜ëŠ” ì‚°ì±…ë¡œ : {{user.profile.feature}}
                        {% endif %}
                    </div>
                    <div id="profile2">			
                        {% if user.profile.likehour == ''%}
                            ì„ í˜¸ ì‹œê°„ëŒ€ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”!
                        {% else %}
                            ì„ í˜¸ ì‹œê°„ëŒ€ : {{user.profile.likehour}}
                        {% endif %}
                    </div>
                    <div id="profile3">
                        {% if user.profile.introduce == ''%}
                            ì†Œê°œê¸€ì„ ë“±ë¡í•´ì„œ ìê¸°ìì‹ ì„ ì†Œê°œí•´ì£¼ì„¸ìš”!
                        {% else %}
                            ì†Œê°œ : {{user.profile.introduce}}
                        {% endif %}
                    </div>
                    {% if user.id == request.user.id %}
                        <a id="edit-profile" href="{% url 'mypage:profile' user.id %}">í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°</a>
                        <a id="edit-myinfo" href="{% url 'checkpw'%}">ë‚´ì •ë³´ ìˆ˜ì •í•˜ê¸°</a>
                    {% endif %}
                </div>
            </div>
            <div class="walkroad-posts">
                <a id="registered-posts">ë“±ë¡í•œ ì‚°ì±…ë¡œ</a>
                <a id="liked-posts">ì¢‹ì•„í•˜ëŠ” ì‚°ì±…ë¡œ</a>
                <input id="search-posts" type="text">
                <button id="search-posts-btn">ê²€ìƒ‰</button>

                <div class="registered-posts">
                    {% for walkroad in registeredWalkroads %}
                        <div class="registered-post">
                            <a href="{% url 'maps:show' walkroad.id %}">{{ walkroad.title }}</a>
                            {{ walkroad.description}}
                        </div>
                    {% endfor %}
                </div>

                <div class="liked-posts">
                    {% for walkroad in likedWalkroads %}
                        <div class="liked-post hide">
                            <a href="{% url 'maps:show' walkroad.id %}">{{ walkroad.title }}</a>
                            {{ walkroad.description}}
                            <a href="{% url 'mypage:mypage' walkroad.author.id %}">{{ walkroad.author.profile.username }}</a>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        {% csrf_token %}
        <div class="mapbox map_wrap">
            <div class="map-input">
                <div class="map-input_wrap">
                    <input type="text" name="location" class ="map-input_location" id="address-location" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”! ex) ì‹ ë¦¼ë¡œ 1"/>
                    <button type="submit" id="address-location-button" class="address-location-button">ì„¤ì •</button>
                </div>
                <button id="current-location-button" class="current-location-button"><img class="current-location-img" src="{% static 'maps/img/location.png' %}"></button>
            </div>
            <div class="mypage-btn">
                <button id="my-walkroad-button" onclick="myWalkroad()" disabled>ë“±ë¡í•œ ì‚°ì±…ë¡œ</button>
                <button id="like-walkroad-button" onclick="likeWalkroad()">ì¢‹ì•„í•œ ì‚°ì±…ë¡œ</button>
            </div>
            <!-- ì§€ë„íƒ€ì… ì»¨íŠ¸ë¡¤ div ì…ë‹ˆë‹¤ -->
            <div class="custom_typecontrol radius_border">
                <span id="btnRoadmap" class="selected_btn" onclick="setMapType('roadmap')">ì§€ë„</span>
                <span id="btnSkyview" class="btn" onclick="setMapType('skyview')">ìŠ¤ì¹´ì´ë·°</span>
            </div>
            <!-- ì§€ë„ í™•ëŒ€, ì¶•ì†Œ ì»¨íŠ¸ë¡¤ div ì…ë‹ˆë‹¤ -->
            <div class="custom_zoomcontrol radius_border"> 
                <span onclick="zoomIn()"><img src="https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/ico_plus.png" alt="í™•ëŒ€"></span>  
                <span onclick="zoomOut()"><img src="https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/ico_minus.png" alt="ì¶•ì†Œ"></span>
            </div>
            {% comment %} ì§€ë„í¬ê¸° {% endcomment %}
            <div id="map" style="width:100%;height:700px;">
                <div id="loading" class="loading-class">
                    <div class="loading-background loading-background_map">
                        <div id="loading-bar-spinner" class="spinner">
                            <div class="spinner-icon"></div>
                        </div>
                        <div class="loading-msg loading-msg_map">ğŸ“í˜„ ìœ„ì¹˜ íŒŒì•… ì¤‘!</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const my_walkroads = {{ my_walkroads | safe }};
    const like_walkroads = {{ like_walkroads | safe }};

    const my_walkroad_paths = {{ my_walkroad_paths | safe }};
    const like_walkroad_paths = {{ like_walkroad_paths | safe }};

    let walkroads = my_walkroads;
    let walkroad_paths = my_walkroad_paths;

    let userAddress;
    if ("{{ request.user.is_anonymous }}" == "True") {
        userAddress = "ì‹ ë¦¼ë¡œ 1";
    } else {
        userAddress = "{{ request.user.profile.location | safe }}";
    }     
    const geocoder = new kakao.maps.services.Geocoder();

    const container = document.getElementById('map');
    const options = {
        center: new kakao.maps.LatLng(33.450701, 126.570667),
        level: 4
    };

    const map = new kakao.maps.Map(container, options);

    let currentLocationMarker;
    let currentLocationInfowindow;

    const setCenterByCurrentLocation = true;

    let overlays = [];
</script>
<script src="{% static 'maps/js/components.js' %}"></script>
<script src="{% static 'maps/js/initial.js' %}"></script>
<script src="{% static 'maps/js/map.js' %}"></script>
<script src="{% static 'maps/js/mypage.js' %}"></script>

<script type="module" src="{% static 'mypage/js/mypage.js' %}"></script>
{% endblock content %}
