{% extends '../base.html' %}
{% load static %}
{% block style %}
{% load sass_tags %}
    <link rel="stylesheet" type="text/css" href="{% sass_src 'mypage/scss/mypage.scss' %}"/>
{% endblock style %}

{% block content %}
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=84f8fca347220d053f38cd40691e54c1&libraries=services,drawing"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="{% static 'mypage/js/mypage.js' %}"></script>

<div class="book-layer">
    <div class="book-layer-left"></div>
    <div class="book-layer-right"></div>
    <div class="mypage-layout">
        <div class="mypage_wrap">
            <div class="profile_wrap">
                <div class="profile">
                    <div class="profile-box">
                        <h1 class="workbook">ğŸ“’&nbsp;&nbsp;{{user.profile.username}}ì˜ ì›Œí¬ë¶{%comment%}<img class="book-img" src="{% static 'maps/img/book.png' %}">{%endcomment%} </h1>
                        <div class="profile-box-container">
                            {% if user.id == 2 %}
                            <img class="profile-img" src="{% static 'mypage/img/yeji.png' %}">
                            {% elif user.id == 3 %}
                            <img class="profile-img" src="{% static 'mypage/img/nayoung.png' %}">
                            {% elif user.id == 4 %}
                            <img class="profile-img" src="{% static 'mypage/img/star.png' %}">
                            {% elif user.id == 5 %}
                            <img class="profile-img" src="{% static 'mypage/img/sewon.png' %}">
                            {% else %}
                            <img class="profile-img" src="{% static 'mypage/img/profileimg.png' %}">        
                            {% endif %}
                            <div class="profile-txt">
                                <div id="walkroad-count">
                                    ì´ {{registeredWalkroads.count}} ê°œì˜ ì‚°ì±…ë¡œë¥¼ ë“±ë¡í–ˆì–´ìš”!
                                </div>
                                <div id="profile1">
                                    {% if user.profile.feature == ''%}
                                        ì•„ì§ ì„ í˜¸í•˜ëŠ” ì‚°ì±…ë¡œ íŠ¹ì§•ì„ ë“±ë¡í•˜ì§€ ì•Šìœ¼ì…¨ë„¤ìš”! 
                                    {% else %}
                                    ì„ í˜¸í•˜ëŠ” ì‚°ì±…ë¡œ : {{user.profile.feature}}
                                    {% endif %}
                                </div>
                                <div id="profile2">			
                                    {% if user.profile.likehour == ''%}
                                        ì„ í˜¸ ì‹œê°„ëŒ€ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”!
                                    {% else %}
                                        ì„ í˜¸ ì‹œê°„ëŒ€ : {{user.profile.likehour}}
                                    {% endif %}
                                </div>
                                <div id="profile3">
                                    {% if user.profile.introduce == ''%}
                                        ì†Œê°œê¸€ì„ ë“±ë¡í•´ì„œ ìê¸°ìì‹ ì„ ì†Œê°œí•´ì£¼ì„¸ìš”!
                                    {% else %}
                                        ì†Œê°œ : {{user.profile.introduce}}
                                    {% endif %}
                                </div>
                                {% if user.id == request.user.id %}
                                <div edit-btn>
                                    <a id="edit-profile" href="{% url 'mypage:profile' user.id %}">í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°</a>
                                    <a id="edit-myinfo" href="{% url 'checkpw'%}">ë‚´ì •ë³´ ìˆ˜ì •í•˜ê¸°</a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="walkroad-posts">
                    <div class="walkroad-posts-header">
                        <div "posts-header">
                            <a class="registered-posts-btn"id="registered-posts" onclick="onClickRegisteredPosts()">ë“±ë¡í•œ ì‚°ì±…ë¡œ</a>
                            <a class="liked-posts-btn"id="liked-posts" onclick="onClickLikedPosts()">ì¢‹ì•„í•˜ëŠ” ì‚°ì±…ë¡œ</a>
                        </div>
                        <div class="post-search-btn">
                            <input id="search-posts" type="text">
                            <button id="search-posts-btn"><img onclick="onClickSearchBtn()"class="searchimg" src="{% static 'maps/img/search.png' %}"></button>
                        </div>
                    </div>

                    <div id="registered-posts-box" class="registered-posts posts-box" style="display: flex;">
                        {% for walkroad in registeredWalkroads %}
                            <div class="registered-post">
                                {% if walkroad.id == 1 %}
                                <img class="registered-img" src="{% static 'maps/img/walkroad1.png' %}">
                                {% elif walkroad.id == 2 %}
                                <img class="registered-img" src="{% static 'maps/img/walkroad2.png' %}">
                                {% elif walkroad.id == 3 %}
                                <img class="registered-img" src="{% static 'maps/img/walkroad3.png' %}">
                                {% elif walkroad.id == 4 %}
                                <img class="registered-img" src="{% static 'maps/img/walkroad4.png' %}">
                                {% elif walkroad.id == 5 %}
                                <img class="registered-img" src="{% static 'maps/img/walkroad5.png' %}">
                                {% elif walkroad.id == 6 %}
                                <img class="registered-img" src="{% static 'maps/img/walkroad6.png' %}">
                                {% elif walkroad.id == 7 %}
                                <img class="registered-img" src="{% static 'maps/img/walkroad7.png' %}">
                                {% elif walkroad.id == 8 %}
                                <img class="registered-img" src="{% static 'maps/img/walkroad8.png' %}">
                                {% elif walkroad.id == 9 %}
                                <img class="registered-img" src="{% static 'maps/img/walkroad9.png' %}">
                                {% else %}                        
                                <img class="registered-img" src="{% static 'mypage/img/pathex.png' %}">
                                {% endif %}
                                <div class="post-txt">
                                    <a id="title-focus" onclick="setFocusClickedPost({{ walkroad.path }})">{{ walkroad.title }}</a>
                                    <span>{{ walkroad.description}}</span>
                                    <a id="post-show" href="{% url 'maps:show' walkroad.id %}">ìƒì„¸ë³´ê¸°</a>
                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    <div id="liked-posts-box" class="liked-posts posts-box">
                        {% for walkroad in likedWalkroads %}
                            <div class="liked-post hide">
                                {% if walkroad.id == 1 %}
                                <img class="liked-img" src="{% static 'maps/img/walkroad1.png' %}">
                                {% elif walkroad.id == 2 %}
                                <img class="liked-img" src="{% static 'maps/img/walkroad2.png' %}">
                                {% elif walkroad.id == 3 %}
                                <img class="liked-img" src="{% static 'maps/img/walkroad3.png' %}">
                                {% elif walkroad.id == 4 %}
                                <img class="liked-img" src="{% static 'maps/img/walkroad4.png' %}">
                                {% elif walkroad.id == 5 %}
                                <img class="liked-img" src="{% static 'maps/img/walkroad5.png' %}">
                                {% elif walkroad.id == 6 %}
                                <img class="liked-img" src="{% static 'maps/img/walkroad6.png' %}">
                                {% elif walkroad.id == 7 %}
                                <img class="liked-img" src="{% static 'maps/img/walkroad7.png' %}">
                                {% elif walkroad.id == 8 %}
                                <img class="liked-img" src="{% static 'maps/img/walkroad8.png' %}">
                                {% elif walkroad.id == 9 %}
                                <img class="liked-img" src="{% static 'maps/img/walkroad9.png' %}">
                                {% else %}                        
                                <img class="liked-img" src="{% static 'mypage/img/pathex.png' %}">
                                {% endif %}
                                <div class="post-txt">
                                    <a id="title-focus" onclick="setFocusClickedPost({{ walkroad.path }})">{{ walkroad.title }}</a>
                                    <span>{{ walkroad.description}}</span>
                                    <div class="liked-link">
                                        <a id="post-show" href="{% url 'maps:show' walkroad.id %}">ìƒì„¸ë³´ê¸°</a>
                                        <a id="username-profile" href="{% url 'mypage:mypage' walkroad.author.id %}">{{ walkroad.author.profile.username }}</a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            {% csrf_token %}
            <div class="mapbox map_wrap">
                <div class="map-input">
                    <div class="map-input_wrap">
                        <input type="text" name="location" class ="map-input_location" id="address-location" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”! ex) ì‹ ë¦¼ë¡œ 1"/>
                        <button type="submit" id="address-location-button" class="address-location-button">ì„¤ì •</button>
                    </div>
                    <button id="current-location-button" class="current-location-button"><img class="current-location-img" src="{% static 'maps/img/location.png' %}"></button>
                </div>
                <!-- ì§€ë„íƒ€ì… ì»¨íŠ¸ë¡¤ div ì…ë‹ˆë‹¤ -->
                <div class="custom_typecontrol radius_border">
                    <span id="btnRoadmap" class="selected_btn" onclick="setMapType('roadmap')">ì§€ë„</span>
                    <span id="btnSkyview" class="btn" onclick="setMapType('skyview')">ìŠ¤ì¹´ì´ë·°</span>
                </div>
                <!-- ì§€ë„ í™•ëŒ€, ì¶•ì†Œ ì»¨íŠ¸ë¡¤ div ì…ë‹ˆë‹¤ -->
                <div class="custom_zoomcontrol radius_border"> 
                    <span onclick="zoomIn()"><img src="https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/ico_plus.png" alt="í™•ëŒ€"></span>  
                    <span onclick="zoomOut()"><img src="https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/ico_minus.png" alt="ì¶•ì†Œ"></span>
                </div>
                {% comment %} ì§€ë„í¬ê¸° {% endcomment %}
                <div id="map" style="width:90%;height:93%;">
                    <div id="loading" class="loading-class">
                        <div class="loading-background loading-background_map">
                            <div id="loading-bar-spinner" class="spinner">
                                <div class="spinner-icon"></div>
                            </div>
                            <div class="loading-msg loading-msg_map">ğŸ“í˜„ ìœ„ì¹˜ íŒŒì•… ì¤‘!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    const my_walkroads = {{ my_walkroads | safe }};
    const like_walkroads = {{ like_walkroads | safe }};

    const my_walkroad_paths = {{ my_walkroad_paths | safe }};
    const like_walkroad_paths = {{ like_walkroad_paths | safe }};
    
    let walkroads = my_walkroads;
    let walkroad_paths = my_walkroad_paths;
    
    let userAddress;
    if ("{{ request.user.is_anonymous }}" == "True") {
        userAddress = "ì‹ ë¦¼ë¡œ 1";
    } else {
        userAddress = "{{ request.user.profile.location | safe }}";
    }     
    const geocoder = new kakao.maps.services.Geocoder();

    const container = document.getElementById('map');
    const options = {
        center: new kakao.maps.LatLng(33.450701, 126.570667),
        level: 4
    };

    const map = new kakao.maps.Map(container, options);

    let currentLocationMarker;
    let currentLocationInfowindow;

    const setCenterByCurrentLocation = true;

    let overlays = [];
</script>
<script src="{% static 'maps/js/components.js' %}"></script>
<script src="{% static 'maps/js/initial.js' %}"></script>
<script src="{% static 'maps/js/map.js' %}"></script>
<script src="{% static 'maps/js/mypage.js' %}"></script>
{% endblock content %}
